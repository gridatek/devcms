import { Component, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { RouterModule } from '@angular/router';
import { Meta, Title } from '@angular/platform-browser';

@Component({
  selector: 'app-category-<%= category.slug %>',
  standalone: true,
  imports: [CommonModule, RouterModule],
  template: `
    <div class="max-w-6xl mx-auto px-4 py-8">
      <header class="text-center mb-12">
        <h1 class="text-4xl font-bold text-gray-900 mb-4">
          <%= category.name %>
        </h1>
        <% if (category.description) { %>
        <p class="text-xl text-gray-600 max-w-2xl mx-auto">
          <%= category.description %>
        </p>
        <% } %>
      </header>

      <% if (posts.length > 0) { %>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        <% posts.forEach(post => { %>
        <article class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
          <% if (post.featured_image) { %>
          <img
            src="<%= post.featured_image %>"
            alt="<%= post.title %>"
            class="w-full h-48 object-cover"
          />
          <% } %>

          <div class="p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-3">
              <a
                routerLink="/blog/<%= post.slug %>"
                class="hover:text-blue-600 transition-colors"
              >
                <%= post.title %>
              </a>
            </h2>

            <% if (post.excerpt) { %>
            <p class="text-gray-600 mb-4">
              <%= post.excerpt %>
            </p>
            <% } %>

            <div class="flex items-center justify-between text-sm text-gray-500">
              <div class="flex items-center">
                <% if (post.author) { %>
                <span class="mr-3">
                  <%= post.author.first_name %> <%= post.author.last_name %>
                </span>
                <% } %>
                <time [attr.datetime]="'<%= post.published_at %>'">
                  <%= new Date(post.published_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) %>
                </time>
              </div>
              <% if (post.reading_time) { %>
              <span><%= post.reading_time %> min read</span>
              <% } %>
            </div>

            <% if (post.tags && post.tags.length > 0) { %>
            <div class="mt-4 pt-4 border-t border-gray-200">
              <div class="flex flex-wrap gap-2">
                <% post.tags.slice(0, 3).forEach(tag => { %>
                <a
                  routerLink="/tag/<%= tag.slug %>"
                  class="inline-block px-2 py-1 rounded text-xs font-medium hover:opacity-80 transition-opacity"
                  style="background-color: <%= tag.color %>20; color: <%= tag.color %>;"
                >
                  <%= tag.name %>
                </a>
                <% }); %>
              </div>
            </div>
            <% } %>
          </div>
        </article>
        <% }); %>
      </div>
      <% } else { %>
      <div class="text-center py-12">
        <h3 class="text-lg font-medium text-gray-900 mb-2">No posts in this category yet</h3>
        <p class="text-gray-600">Check back later for new content.</p>
      </div>
      <% } %>

      <!-- Back to all categories -->
      <div class="mt-12 text-center">
        <a
          routerLink="/blog"
          class="inline-flex items-center text-blue-600 hover:text-blue-800 font-medium"
        >
          <svg class="mr-2 w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
          </svg>
          Back to all posts
        </a>
      </div>
    </div>
  `
})
export class Category<%= category.slug.charAt(0).toUpperCase() + category.slug.slice(1).replace(/-/g, '') %>Component implements OnInit {

  constructor(
    private meta: Meta,
    private title: Title
  ) {}

  ngOnInit(): void {
    this.setSEO();
  }

  private setSEO(): void {
    const pageTitle = '<%= category.name %>';
    this.title.setTitle(`${pageTitle} | <%= site.name %>`);

    <% if (category.description) { %>
    this.meta.updateTag({
      name: 'description',
      content: '<%= category.description.replace(/'/g, "\\'") %>'
    });
    <% } %>

    // Open Graph tags
    this.meta.updateTag({ property: 'og:title', content: `${pageTitle} | <%= site.name %>` });
    <% if (category.description) { %>
    this.meta.updateTag({
      property: 'og:description',
      content: '<%= category.description.replace(/'/g, "\\'") %>'
    });
    <% } %>
    this.meta.updateTag({ property: 'og:type', content: 'website' });
  }
}